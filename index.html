<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device=device-width, initial-scale=1"/>
  <title>BJJ 스타일 테스트</title>

  <!-- ✅ OG/Twitter 썸네일 (원하면 이미지 URL 바꿔도 됨) -->
  <meta property="og:title" content="BJJ 스타일 테스트"/>
  <meta property="og:description" content="8문항으로 내 주짓수 스타일과 닮은 선수 + 스파이더차트"/>
  <meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/0/0e/Gordon_Ryan_2019.jpg"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:image" content="https://upload.wikimedia.org/wikipedia/commons/0/0e/Gordon_Ryan_2019.jpg"/>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Kakao SDK (선택: 카카오 전용 버튼 쓸 때만 키 넣으면 됨) -->
  <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>

  <style>
    body { font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial }
    .glass { backdrop-filter: blur(8px); }
  </style>
</head>
<body class="bg-gradient-to-b from-gray-50 to-white min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    const { useMemo, useState, useEffect, useRef } = React;

    /* =========================
       0) 다국어 & 언어 감지
    ========================== */
    const STR = {
      ko: { title:"주짓수 플레이 스타일 테스트", subtitle:"8문항으로 닮은 선수와 스파이더차트를 확인하세요.",
            start:"시작하기", next:"다음", prev:"이전", submit:"결과 보기", restart:"다시 하기", share:"링크 복사",
            yourResult:"당신과 닮은 스타일", shareVia:"공유하기", copied:"링크를 복사했습니다.",
            kakaoTip:"카카오 전용 버튼은 도메인 등록+JS 키 필요(없으면 링크 공유 사용)" },
      en: { title:"BJJ Play-Style Test", subtitle:"Answer 8 questions to see your match + spider chart.",
            start:"Start", next:"Next", prev:"Back", submit:"See Result", restart:"Restart", share:"Copy Link",
            yourResult:"Your Matching Style", shareVia:"Share via", copied:"Link copied!",
            kakaoTip:"Kakao button needs domain whitelist + JS key (use link share otherwise)" },
      ja: { title:"BJJ スタイル診断", subtitle:"8問で似ている選手とレーダーチャートを表示。",
            start:"開始", next:"次へ", prev:"戻る", submit:"結果を見る", restart:"やり直す", share:"リンクをコピー",
            yourResult:"あなたに近いスタイル", shareVia:"共有", copied:"リンクをコピーしました。",
            kakaoTip:"カカオ共有はドメイン登録とJSキーが必要（無ければリンク共有）" },
    };
    const SUPPORTED = ["ko","en","ja"];
    function detectLang() {
      const urlLang = new URLSearchParams(location.search).get("lang");
      if (urlLang && SUPPORTED.includes(urlLang)) return urlLang;
      const langs = navigator.languages || [navigator.language || "en"];
      for (const l of langs) {
        const code = (l||"").toLowerCase().split("-")[0];
        if (SUPPORTED.includes(code)) return code;
      }
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || "";
      if (tz.includes("Seoul")) return "ko";
      if (tz.includes("Tokyo")) return "ja";
      return "en";
    }

    /* =========================
       1) 축/가중치(전문가 납득용)
    ========================== */
    const AXES = [
      { key:"control",     label:{ko:"컨트롤",      en:"Control",       ja:"コントロール"} },
      { key:"pressure",    label:{ko:"압박",        en:"Pressure",      ja:"プレッシャー"} },
      { key:"scramble",    label:{ko:"스크램블",    en:"Scramble",      ja:"スクランブル"} },
      { key:"leglock",     label:{ko:"레그락",      en:"Leglocks",      ja:"レッグロック"} },
      { key:"berimbolo",   label:{ko:"베림보로",    en:"Berimbolo",     ja:"ベリンボロ"} },
      { key:"fundamental", label:{ko:"기본기",      en:"Fundamentals",  ja:"基礎"} },
      { key:"wrestling",   label:{ko:"레슬링/TD",   en:"Wrestling/TD",  ja:"レスリング/TD"} },
      { key:"mental",      label:{ko:"전략/멘탈",   en:"Strategy/Mental", ja:"戦略/メンタル"} },
    ];
    const WEIGHTS = { control:1.2, pressure:1.1, scramble:1.0, leglock:1.2, berimbolo:0.8, fundamental:1.0, wrestling:0.9, mental:1.0 };

    /* =========================
       2) 선수 라인업 확장 (이미지 폴백 포함)
          - 실제 사진이 막힐 때를 대비해 data:svg 폴백 포함
    ========================== */
    const PH = (name) =>
      `data:image/svg+xml;charset=UTF-8,` +
      encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='900' height='600'>
        <defs><linearGradient id='g' x1='0' x2='1'><stop offset='0%' stop-color='#f3f4f6'/><stop offset='100%' stop-color='#e5e7eb'/></linearGradient></defs>
        <rect width='100%' height='100%' fill='url(#g)'/>
        <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='40' fill='#6b7280' font-family='Arial, Helvetica, sans-serif'>${name}</text>
      </svg>`);

    // SmartImage: 여러 소스 시도 + no-referrer + 마지막엔 placeholder
    function SmartImage({ srcs, alt, className }) {
      const arr = Array.isArray(srcs) ? srcs.filter(Boolean) : [srcs];
      const [idx, setIdx] = React.useState(0);
      const curr = arr[idx] || PH(alt || "BJJ");
      return (
        <img
          src={curr}
          alt={alt}
          referrerPolicy="no-referrer"
          className={className}
          onError={() => { if (idx < arr.length - 1) setIdx(idx + 1); else if (curr.startsWith("data:") === false) setIdx(arr.length - 1); }}
        />
      );
    }

    // 확장 라인업 (유명 + 카테고리 충돌 최소화) *이미지 1순위: 위키, 2순위: 폴백*
    const ATHLETES = [
      { id:"roger",    name:"Roger Gracie",      img:["https://upload.wikimedia.org/wikipedia/commons/2/2f/Roger_Gracie_2014.jpg", PH("Roger Gracie")],
        traits:["포지셔널 도미넌스","프레셔 패싱","정석 피니시"], compliment:"기본기와 안정감으로 경기를 지배하는 타입!" },
      { id:"marcelo",  name:"Marcelo Garcia",    img:["https://upload.wikimedia.org/wikipedia/commons/7/72/Marcelo_Garcia_2009_ADCC.jpg", PH("Marcelo Garcia")],
        traits:["버터플라이/엑스","스크램블","초크 지향"], compliment:"타이밍 장인! 작은 틈으로 흐름을 바꿉니다." },
      { id:"gordon",   name:"Gordon Ryan",       img:["https://upload.wikimedia.org/wikipedia/commons/0/0e/Gordon_Ryan_2019.jpg", PH("Gordon Ryan")],
        traits:["시퀀스 체계","바디락/니컷","레그락"], compliment:"한 수 앞을 읽는 설계자! 시스템으로 상대를 묶습니다." },
      { id:"mikey",    name:"Mikey Musumeci",    img:["https://upload.wikimedia.org/wikipedia/commons/8/83/Mikey_Musumeci_2019.jpg", PH("Mikey Musumeci")],
        traits:["정교한 디테일","각도 만들기","라이트급 테크니션"], compliment:"디테일 장인! 미세한 각도로 끝냅니다." },
      { id:"gabi",     name:"Gabi Garcia",       img:["https://upload.wikimedia.org/wikipedia/commons/5/58/Gabi_Garcia_2013.jpg", PH("Gabi Garcia")],
        traits:["피지컬·테크닉 밸런스","탑 압박","멘탈"], compliment:"존재감과 힘의 조화! 상단에서 주도합니다." },
      { id:"adam",     name:"Adam Wardzinski",   img:["https://upload.wikimedia.org/wikipedia/commons/8/87/Adam_Wardzinski_2019.jpg", PH("Adam Wardzinski")],
        traits:["버터플라이 교본","암드래그·스윕","탑 전환"], compliment:"버터플라이의 교과서! 언밸런스로 기회를 만듭니다." },
      { id:"cade",     name:"Kade Ruotolo",      img:["https://upload.wikimedia.org/wikipedia/commons/2/2d/Kade_Ruotolo_2022.jpg", PH("Kade Ruotolo")],
        traits:["하이 템포","레슬 엔트리·다스","다이나믹"], compliment:"템포의 화신! 끊임없이 몰아붙입니다." },
      { id:"tye",      name:"Tye Ruotolo",       img:["https://upload.wikimedia.org/wikipedia/commons/8/8c/Tye_Ruotolo_2022.jpg", PH("Tye Ruotolo")],
        traits:["공격적 패싱","레슬/스크램블","다이나믹"], compliment:"탑에서 파고드는 공격성으로 흔듭니다." },
      { id:"miyao",    name:"Paulo Miyao",       img:["https://upload.wikimedia.org/wikipedia/commons/9/9a/Paulo_Miyao_2014.jpg", PH("Paulo Miyao")],
        traits:["베림보로 시스템","DLR & 스핀백","백 테이크"], compliment:"회전으로 공간을 여는 베림보로 마스터!" },
      { id:"meregali", name:"Nicholas Meregali", img:["https://upload.wikimedia.org/wikipedia/commons/0/0e/Nicholas_Meregali_2017.jpg", PH("Nicholas Meregali")],
        traits:["프레셔·탑 컨트롤","정석 서브미션","레슬/투사"], compliment:"강력한 탑 컨트롤과 정석의 교본!" },
      // 추가 라인업 (이미지 폴백 우선 설계)
      { id:"craig",    name:"Craig Jones",       img:[null, PH("Craig Jones")],
        traits:["레그락 체인","오픈 가드","스크램블"], compliment:"레그 체인으로 흐름을 휘어잡는 다이내믹 파이터." },
      { id:"tonon",    name:"Garry Tonon",       img:[null, PH("Garry Tonon")],
        traits:["스크램블","레그락","공격적 전환"], compliment:"폭발적 전환으로 상대를 흔드는 스타일." },
      { id:"pena",     name:"Felipe Pena",       img:[null, PH("Felipe Pena")],
        traits:["백 컨트롤","베이직+모던","전략 운영"], compliment:"전략적 운영과 백 장악에 탁월." },
      { id:"lepri",    name:"Lucas Lepri",       img:[null, PH("Lucas Lepri")],
        traits:["교과서 패싱","컨트롤","기본기"], compliment:"정교한 패싱과 컨트롤의 정석." },
      { id:"jt",       name:"JT Torres",         img:[null, PH("JT Torres")],
        traits:["탑 컨트롤","레슬링/TD","기본기"], compliment:"레슬 기반 탑 운영의 정석." },
      { id:"tainan",   name:"Tainan Dalpra",     img:[null, PH("Tainan Dalpra")],
        traits:["기본기 정밀","탑 컨트롤","하이 퍼포먼스"], compliment:"정밀한 기본기로 경기를 해석." },
      { id:"mica",     name:"Mica Galvão",       img:[null, PH("Mica Galvão")],
        traits:["공격적 피니시","오픈 가드","하이 템포"], compliment:"공격성과 템포로 주도하는 신성." },
      { id:"mayssa",   name:"Mayssa Bastos",     img:[null, PH("]()
