<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BJJ ìŠ¤íƒ€ì¼ í…ŒìŠ¤íŠ¸</title>

  <meta property="og:title" content="BJJ ìŠ¤íƒ€ì¼ í…ŒìŠ¤íŠ¸"/>
  <meta property="og:description" content="ì„¸ë°€ ë¬¸í•­ìœ¼ë¡œ ë‚´ ì£¼ì§“ìˆ˜ ìŠ¤íƒ€ì¼ ë§¤ì¹­ + ìŠ¤íŒŒì´ë”ì°¨íŠ¸"/>
  <meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/0/0e/Gordon_Ryan_2019.jpg"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:image" content="https://upload.wikimedia.org/wikipedia/commons/0/0e/Gordon_Ryan_2019.jpg"/>

  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <!-- ğŸ”§ ì˜¤íƒ€ ìˆ˜ì •: react-dom.development.js -->
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>

  <style>
    body { font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial }
    .glass { backdrop-filter: blur(8px); }
  </style>
</head>
<body class="bg-gradient-to-b from-gray-50 to-white min-h-screen">
  <div id="root"></div>

  <script type="text/babel" data-presets="env,react">
    const { useMemo, useState, useEffect, useRef } = React;

    /* ================= Error Boundary ================ */
    class ErrorBoundary extends React.Component {
      constructor(props){ super(props); this.state={hasError:false, err:null}; }
      static getDerivedStateFromError(err){ return {hasError:true, err}; }
      componentDidCatch(err, info){ console.error("Render error:", err, info); }
      render(){
        if(!this.state.hasError) return this.props.children;
        return (
          <div className="p-4 border rounded-2xl bg-red-50 text-red-800">
            <div className="font-bold mb-1">ê²°ê³¼ í‘œì‹œ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆì–´ìš”.</div>
            <div className="text-sm">ê·¸ë˜ë„ í…ŒìŠ¤íŠ¸ëŠ” ì™„ë£Œë˜ì—ˆê³ , í•˜ë‹¨ ë²„íŠ¼ìœ¼ë¡œ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
            {this.props.fallback}
          </div>
        );
      }
    }

    /* ================= i18n ================= */
    const STR = {
      ko: { title:"ì£¼ì§“ìˆ˜ í”Œë ˆì´ ìŠ¤íƒ€ì¼ í…ŒìŠ¤íŠ¸", subtitle:"ì„¸ë°€ ë¬¸í•­ìœ¼ë¡œ ë‹®ì€ ì„ ìˆ˜ì™€ ìŠ¤íŒŒì´ë”ì°¨íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.",
        start:"ì‹œì‘í•˜ê¸°", next:"ë‹¤ìŒ", prev:"ì´ì „", submit:"ê²°ê³¼ ë³´ê¸°", restart:"ë‹¤ì‹œ í•˜ê¸°",
        share:"ë§í¬ ë³µì‚¬", yourResult:"ë‹¹ì‹ ê³¼ ë‹®ì€ ìŠ¤íƒ€ì¼", shareVia:"ê³µìœ í•˜ê¸°", copied:"ë§í¬ë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤." },
      en: { title:"BJJ Play-Style Test", subtitle:"Detailed questions for precise match + spider chart.",
        start:"Start", next:"Next", prev:"Back", submit:"See Result", restart:"Restart",
        share:"Copy Link", yourResult:"Your Matching Style", shareVia:"Share via", copied:"Link copied!" },
      ja: { title:"BJJ ã‚¹ã‚¿ã‚¤ãƒ«è¨ºæ–­", subtitle:"è©³ç´°ãªè¨­å•ã§ç²¾å¯†ãƒãƒƒãƒï¼‹ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€‚",
        start:"é–‹å§‹", next:"æ¬¡ã¸", prev:"æˆ»ã‚‹", submit:"çµæœã‚’è¦‹ã‚‹", restart:"ã‚„ã‚Šç›´ã™",
        share:"ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼", yourResult:"ã‚ãªãŸã«è¿‘ã„ã‚¹ã‚¿ã‚¤ãƒ«", shareVia:"å…±æœ‰", copied:"ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚" },
    };
    const SUPPORTED = ["ko","en","ja"];
    function detectLang() {
      const urlLang = new URLSearchParams(location.search).get("lang");
      if (urlLang && SUPPORTED.includes(urlLang)) return urlLang;
      const langs = navigator.languages || [navigator.language || "en"];
      for (const l of langs) {
        const code = (l||"").toLowerCase().split("-")[0];
        if (SUPPORTED.includes(code)) return code;
      }
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || "";
      if (tz.includes("Seoul")) return "ko";
      if (tz.includes("Tokyo")) return "ja";
      return "en";
    }

    /* ================= ì¶• & ê°€ì¤‘ì¹˜ ================= */
    const AXES = [
      { key:"control",       label:{ko:"í¬ì§€ì…˜ ì»¨íŠ¸ë¡¤",  en:"Positional Control", ja:"ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«"} },
      { key:"pressure",      label:{ko:"í”„ë ˆì…” íŒ¨ì‹±",    en:"Pressure Passing",   ja:"ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼"} },
      { key:"mobility",      label:{ko:"ëª¨ë¹Œë¦¬í‹° íŒ¨ì‹±",  en:"Mobility Passing",   ja:"ãƒ¢ãƒ“ãƒªãƒ†ã‚£"} },
      { key:"scramble",      label:{ko:"í…œí¬/ìŠ¤í¬ë¨ë¸”",  en:"Tempo/Scramble",     ja:"ãƒ†ãƒ³ãƒ/ã‚¹ã‚¯ãƒ©ãƒ³ãƒ–ãƒ«"} },
      { key:"leglock",       label:{ko:"ë ˆê·¸ë½",          en:"Leglocks",           ja:"ãƒ¬ãƒƒã‚°ãƒ­ãƒƒã‚¯"} },
      { key:"berimbolo",     label:{ko:"ë² ë¦¼ë³´ë¡œ",        en:"Berimbolo",          ja:"ãƒ™ãƒªãƒ³ãƒœãƒ­"} },
      { key:"lapel",         label:{ko:"ë¼í /ì›œ",        en:"Lapel/Worm",         ja:"ãƒ©ãƒšãƒ«/ãƒ¯ãƒ¼ãƒ "} },
      { key:"fundamental",   label:{ko:"ì •ì„(ê¸°ë³¸ê¸°)",    en:"Fundamentals",       ja:"åŸºç¤"} },
      { key:"wrestling",     label:{ko:"ë ˆìŠ¬/TD",        en:"Wrestling/TD",       ja:"ãƒ¬ã‚¹ãƒªãƒ³ã‚°/TD"} },
      { key:"backtake",      label:{ko:"ë°± í…Œì´í¬",      en:"Back Takes",         ja:"ãƒãƒƒã‚¯ãƒ†ã‚¤ã‚¯"} },
      { key:"fronthead",     label:{ko:"í”„ë¡ íŠ¸ í—¤ë“œë¡",  en:"Front Headlock",     ja:"ãƒ•ãƒ­ãƒ³ãƒˆãƒ˜ãƒƒãƒ‰ãƒ­ãƒƒã‚¯"} },
      { key:"guardret",      label:{ko:"ê°€ë“œ ë¦¬í…ì…˜",    en:"Guard Retention",    ja:"ã‚¬ãƒ¼ãƒ‰ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³"} },
      { key:"finish",        label:{ko:"í”¼ë‹ˆì‹œ ì§€í–¥",    en:"Finish Orientation", ja:"ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥å¿—å‘"} },
    ];
    const WEIGHTS = {
      control:1.15, pressure:1.1, mobility:1.0, scramble:1.0,
      leglock:1.2, berimbolo:0.9, lapel:0.9, fundamental:1.0,
      wrestling:1.0, backtake:1.15, fronthead:1.0, guardret:1.0,
      finish:1.15
    };

    /* ================= ì´ë¯¸ì§€ í´ë°± ================= */
    const PH = (name) =>
      `data:image/svg+xml;charset=UTF-8,` +
      encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='900' height='600'>
        <defs><linearGradient id='g' x1='0' x2='1'><stop offset='0%' stop-color='#f3f4f6'/><stop offset='100%' stop-color='#e5e7eb'/></linearGradient></defs>
        <rect width='100%' height='100%' fill='url(#g)'/>
        <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='40' fill='#6b7280' font-family='Arial, Helvetica, sans-serif'>${name}</text>
      </svg>`);
    function SmartImage({ srcs, alt, className }) {
      const arr = Array.isArray(srcs) ? srcs.filter(Boolean) : [srcs];
      const [idx, setIdx] = React.useState(0);
      const curr = arr[idx] || PH(alt || "BJJ");
      return (
        <img
          src={curr}
          alt={alt}
          referrerPolicy="no-referrer"
          className={className}
          onError={() => { if (idx < arr.length - 1) setIdx(idx + 1); else if (!curr.startsWith("data:")) setIdx(arr.length - 1); }}
        />
      );
    }

    /* ================= ì„ ìˆ˜ ë¼ì¸ì—… ================= */
    const ATHLETES = [
      { id:"gordon",   name:"Gordon Ryan",     img:["https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/ADCC_King_Gordon_Ryan_Gritty_Path_To_Glory_-_YouTube_-_10_12_%28cropped%29.jpg/640px-ADCC_King_Gordon_Ryan_Gritty_Path_To_Glory_-_YouTube_-_10_12_%28cropped%29.jpg", PH("Gordon Ryan")],
        traits:["ì‹œí€€ìŠ¤ ì²´ê³„","ë°”ë””ë½/ë‹ˆì»·","ë ˆê·¸ë½"], compliment:"ê²½ê¸°ë¥¼ ì„¤ê³„í•˜ê³  í†µì œí•˜ëŠ” ì „ëµí˜•." },
      { id:"kaynan",   name:"Kaynan Duarte",   img:["https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/Kaynan_Duarte_ADCC_2019_%28cropped%29.jpg/640px-Kaynan_Duarte_ADCC_2019_%28cropped%29.jpg", PH("Kaynan Duarte")],
        traits:["ë”ë¸”ê³¨ë“œ(ADCCâ€™24)","ì••ë°•+ëª¨ë¹Œë¦¬í‹°","ê¸¸ë¡œí‹´/í”„ë¡ íŠ¸ì²´ì¸"], compliment:"ê· í˜• ì¡íŒ íŒŒì›Œ/ê¸°ìˆ ë¡œ êµ­ë©´ì„ ì§€ë°°." },
      { id:"mica",     name:"Mica GalvÃ£o",     img:["https://upload.wikimedia.org/wikipedia/commons/thumb/8/85/Vlog-6_FINALIZOU_EM_1_MINUTO%21%21%21_Veja_s%C3%B3%21_-_YouTube_-_13-49_%28cropped%29.jpg/640px-Vlog-6_FINALIZOU_EM_1_MINUTO%21%21%21_Veja_s%C3%B3%21_-_YouTube_-_13-49_%28cropped%29.jpg", PH("Mica GalvÃ£o")],
        traits:["í•˜ì´ í…œí¬","í”¼ë‹ˆì‹œ ì„±í–¥","77kg ê°•ì"], compliment:"í…œí¬ë¡œ í”ë“¤ê³  í”¼ë‹ˆì‹œë¡œ ë§ˆë¬´ë¦¬." },
      { id:"diogo",    name:"Diogo Reis",      img:["https://cdn.onefc.com/wp-content/uploads/2025/03/Diogo_Reis-Hero-1200x1165-1-768x746.jpg", PH("Diogo Reis")],
        traits:["-66kg ê°•ì","ëª¨ë¹Œë¦¬í‹°","ë°±í…Œì´í¬"], compliment:"ë¯¼ì²©í•œ ì „í™˜ê³¼ ë‚ ì¹´ë¡œìš´ ë°± ê²Œì„." },
      { id:"bodoni",   name:"Giancarlo Bodoni",img:["https://cdn.onefc.com/wp-content/uploads/2024/12/GiancarloBodoni-1200X800.jpg", PH("Giancarlo Bodoni")],
        traits:["-88kg ê°•ì","ì²´ê³„ì  íŒ¨ì‹±","ì»¨íŠ¸ë¡¤"], compliment:"ì •ëˆëœ ì‹œí€€ìŠ¤ë¡œ ì•ˆì •ì  ìš°ì„¸ë¥¼ ìŒ“ìŒ." },
      { id:"pena",     name:"Felipe Pena",     img:["https://images.tapology.com/letterbox_images/214308/default/Untitled17.jpg?1595596586", PH("Felipe Pena")],
        traits:["+99kg ê°•ì","ë°± ì»¨íŠ¸ë¡¤","ì „ëµ ìš´ì˜"], compliment:"ì „í†µê³¼ í˜„ëŒ€ê°€ ì„ì¸ ì•ˆì •ì  í”¼ë‹ˆì…”." },
      { id:"nickyrod", name:"Nick Rodriguez",  img:["https://d2779tscntxxsw.cloudfront.net/61ea28ee992bb.png?width=1800", PH("Nick Rodriguez")],
        traits:["ë ˆìŠ¬/íƒ‘ì»¨","ìŠ¤í¬ë¨ë¸”","CJI ì„íŒ©íŠ¸"], compliment:"ë ˆìŠ¬ê³¼ ì²´ë ¥ìœ¼ë¡œ ìƒë‹¨ì—ì„œ ì••ë°•." },
      { id:"craig",    name:"Craig Jones",     img:["https://upload.wikimedia.org/wikipedia/commons/thumb/b/b3/Craig_Jones.jpg/640px-Craig_Jones.jpg", PH("Craig Jones")],
        traits:["ë ˆê·¸ë½ ì‹œìŠ¤í…œ","K-ê°€ë“œ","CJI ì£¼ì—­"], compliment:"í•©ë¦¬ì  ë ˆê·¸ ì²´ì¸ìœ¼ë¡œ ê¸°íšŒë¥¼ ì°½ì¶œ." },
      { id:"luke",     name:"Luke Griffith",   img:["https://d2779tscntxxsw.cloudfront.net/63503a277914f.png?width=1800", PH("Luke Griffith")],
        traits:["í—¤ë¹„ê¸‰ ê°•ì","New Wave","ìƒì²´ ì²´ì¸"], compliment:"ê²¬ê³ í•œ ì»¨íŠ¸ë¡¤ê³¼ ìƒì²´ ì²´ì¸." },
      { id:"helena",   name:"Helena Crevar",   img:["https://d2779tscntxxsw.cloudfront.net/6443c2c2ef72f.png?width=1800", PH("Helena Crevar")],
        traits:["CJI ìš°ìŠ¹","ë‹¤ì´ë‚˜ë¯¹","ì„œë¸Œë¯¸ì…˜ ìœ„í˜‘"], compliment:"ì Šì€ ì—ë„ˆì§€ë¡œ ì‹œì¢…ì¼ê´€ ê³µê²© êµ¬ì‚¬." },

      { id:"meregali", name:"Nicholas Meregali", img:["https://upload.wikimedia.org/wikipedia/commons/0/0e/Nicholas_Meregali_2017.jpg", PH("Nicholas Meregali")],
        traits:["ê¸° ê°•ì","íƒ‘ ì»¨íŠ¸ë¡¤","ì„œë¸Œë¯¸ì…˜"], compliment:"ì •ì„ê³¼ í”¼ì§€ì»¬ì´ ì¡°í™”ëœ êµë³¸í˜•." },
      { id:"tainan",   name:"Tainan Dalpra",   img:["https://d2779tscntxxsw.cloudfront.net/60b94c34a4ab5.png?width=1800", PH("Tainan Dalpra")],
        traits:["ê¸° í…Œí¬ë‹ˆì…˜","ë¼ì¸Â·ê°ë„","í¬ì§€ì…”ë„"], compliment:"ë””í…Œì¼ë¡œ ê³µê°„ì„ ë§Œë“œëŠ” í…Œí¬ë‹ˆì…˜." },
      { id:"keenan",   name:"Keenan Cornelius", img:["https://d2779tscntxxsw.cloudfront.net/60b94e820c229.png?width=1800", PH("Keenan Cornelius")],
        traits:["ë¼í /ì›œ","ê°€ë“œ ì „í™˜","ì‹œìŠ¤í…œ"], compliment:"ë¼í  ì‹œìŠ¤í…œìœ¼ë¡œ íë¦„ì„ ì„¤ê³„." },
      { id:"rafa",     name:"Rafael Mendes",   img:["https://upload.wikimedia.org/wikipedia/commons/b/b5/Rafael_Mendes_2011_ADCC_%28cropped%29.jpg", PH("Rafael Mendes")],
        traits:["DLR/ë² ë¦¼ë³´ë¡œ","ë°±í…Œì´í¬","í˜ë” ì „ì„¤"], compliment:"ì •ë°€í•œ ê°ë„ë¡œ ë°±ì„ ì¥ì•…í•˜ëŠ” ì•„í‹°ìŠ¤íŠ¸." },
      { id:"cobrinha", name:"Rubens \"Cobrinha\" Charles", img:["https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Rubens_Charles_%22Cobrinha%22.jpg/640px-Rubens_Charles_%22Cobrinha%22.jpg", PH("Cobrinha")],
        traits:["ê°€ë“œ ë¦¬í…ì…˜","ë°± ìœ„í˜‘","í…œí¬"], compliment:"ë¦¬í…ì…˜-ë°± ì²´ì¸ìœ¼ë¡œ ìƒì‹œ ì••ë°•." },

      { id:"mikey",    name:"Mikey Musumeci",  img:["https://upload.wikimedia.org/wikipedia/commons/8/83/Mikey_Musumeci_2019.jpg", PH("Mikey Musumeci")],
        traits:["ì •êµ ë””í…Œì¼","ë¼ì´íŠ¸ê¸‰","í•˜ì´ ê°€ë“œIQ"], compliment:"ë””í…Œì¼ë¡œ ìŠ¹ë¶€ ë³´ëŠ” ì •ë°€ í…Œí¬ë‹ˆì…˜." },
      { id:"tye",      name:"Tye Ruotolo",     img:["https://upload.wikimedia.org/wikipedia/commons/8/8c/Tye_Ruotolo_2022.jpg", PH("Tye Ruotolo")],
        traits:["ê³µê²©ì  íŒ¨ì‹±","ë ˆìŠ¬/ìŠ¤í¬ë¨ë¸”","ë‹¤ì´ë‚˜ë¯¹"], compliment:"íƒ‘ì—ì„œ íŒŒê³ ë“œëŠ” ê³µê²©ì„±ìœ¼ë¡œ í”ë“­ë‹ˆë‹¤." },
      { id:"cade",     name:"Kade Ruotolo",    img:["https://upload.wikimedia.org/wikipedia/commons/2/2d/Kade_Ruotolo_2022.jpg", PH("Kade Ruotolo")],
        traits:["í•˜ì´ í…œí¬","ë‹¤ìŠ¤/í”„ë¡ íŠ¸ì²´ì¸","ë‹¤ì´ë‚˜ë¯¹"], compliment:"ëŠì„ì—†ëŠ” í…œí¬ë¡œ ì••ë°•í•˜ëŠ” íŒŒì´í„°." },
      { id:"roger",    name:"Roger Gracie",    img:["https://upload.wikimedia.org/wikipedia/commons/2/2f/Roger_Gracie_2014.jpg", PH("Roger Gracie")],
        traits:["í¬ì§€ì…”ë„ êµê³¼ì„œ","í”„ë ˆì…”","ì •ì„ í”¼ë‹ˆì‹œ"], compliment:"ê¸°ë³¸ê¸°ë¡œ ê²½ê¸°ë¥¼ ì§€ë°°í•˜ëŠ” ì•ˆì •í˜•." },
      { id:"marcelo",  name:"Marcelo Garcia",  img:["https://upload.wikimedia.org/wikipedia/commons/7/72/Marcelo_Garcia_2009_ADCC.jpg", PH("Marcelo Garcia")],
        traits:["ë²„í„°í”Œë¼ì´/ì—‘ìŠ¤","ìŠ¤í¬ë¨ë¸”","ì´ˆí¬"], compliment:"íƒ€ì´ë° ì¥ì¸, íë¦„ ì „í™˜ì— íƒì›”." },
    ];

    /* ================= í”„ë¡œí•„(ìŠ¤íƒ¯ ì •ë‹µê°’) ================= */
    const PROFILES = {
      gordon:   {control:9, pressure:8, mobility:7, scramble:6, leglock:10, berimbolo:1, lapel:0, fundamental:8, wrestling:8, backtake:9, fronthead:8, guardret:8, finish:9},
      kaynan:   {control:9, pressure:9, mobility:8, scramble:7, leglock:5,  berimbolo:2, lapel:2, fundamental:9, wrestling:8, backtake:8, fronthead:9, guardret:8, finish:7},
      mica:     {control:7, pressure:6, mobility:8, scramble:9, leglock:6,  berimbolo:3, lapel:0, fundamental:7, wrestling:7, backtake:8, fronthead:9, guardret:8, finish:9},
      diogo:    {control:7, pressure:5, mobility:9, scramble:9, leglock:5,  berimbolo:3, lapel:0, fundamental:8, wrestling:6, backtake:9, fronthead:5, guardret:9, finish:8},
      bodoni:   {control:9, pressure:8, mobility:6, scramble:6, leglock:5,  berimbolo:2, lapel:0, fundamental:9, wrestling:6, backtake:8, fronthead:6, guardret:8, finish:6},
      pena:     {control:9, pressure:8, mobility:6, scramble:6, leglock:4,  berimbolo:2, lapel:2, fundamental:9, wrestling:7, backtake:9, fronthead:5, guardret:8, finish:8},
      nickyrod: {control:7, pressure:8, mobility:6, scramble:9, leglock:4,  berimbolo:0, lapel:0, fundamental:7, wrestling:10,backtake:7, fronthead:7, guardret:7, finish:5},
      craig:    {control:7, pressure:5, mobility:6, scramble:7, leglock:10, berimbolo:3, lapel:0, fundamental:7, wrestling:5, backtake:7, fronthead:6, guardret:8, finish:9},
      luke:     {control:8, pressure:7, mobility:6, scramble:6, leglock:5,  berimbolo:1, lapel:0, fundamental:8, wrestling:7, backtake:7, fronthead:7, guardret:8, finish:6},
      helena:   {control:7, pressure:5, mobility:7, scramble:8, leglock:6,  berimbolo:3, lapel:0, fundamental:7, wrestling:5, backtake:8, fronthead:5, guardret:8, finish:8},

      meregali: {control:9, pressure:9, mobility:6, scramble:6, leglock:3,  berimbolo:2, lapel:4, fundamental:9, wrestling:7, backtake:8, fronthead:4, guardret:8, finish:8},
      tainan:   {control:9, pressure:7, mobility:7, scramble:6, leglock:3,  berimbolo:3, lapel:6, fundamental:10,wrestling:6, backtake:8, fronthead:4, guardret:9, finish:7},
      keenan:   {control:7, pressure:5, mobility:6, scramble:6, leglock:5,  berimbolo:6, lapel:10,fundamental:8, wrestling:4, backtake:8, fronthead:4, guardret:9, finish:6},
      rafa:     {control:8, pressure:6, mobility:8, scramble:8, leglock:4,  berimbolo:9, lapel:6, fundamental:9, wrestling:6, backtake:10,fronthead:5, guardret:9, finish:9},
      cobrinha: {control:8, pressure:7, mobility:8, scramble:9, leglock:4,  berimbolo:6, lapel:5, fundamental:9, wrestling:6, backtake:9, fronthead:6, guardret:10, finish:8},

      mikey:    {control:7, pressure:4, mobility:7, scramble:6, leglock:7,  berimbolo:7, lapel:5, fundamental:9, wrestling:3, backtake:7, fronthead:4, guardret:9, finish:8},
      tye:      {control:6, pressure:7, mobility:8, scramble:9, leglock:6,  berimbolo:2, lapel:0, fundamental:7, wrestling:8, backtake:8, fronthead:9, guardret:7, finish:8},
      cade:     {control:6, pressure:6, mobility:8, scramble:10,leglock:7,  berimbolo:3, lapel:0, fundamental:6, wrestling:8, backtake:8, fronthead:9, guardret:7, finish:9},
      roger:    {control:10,pressure:9, mobility:4, scramble:3, leglock:3,  berimbolo:0, lapel:4, fundamental:10,wrestling:6, backtake:9, fronthead:4, guardret:8, finish:8},
      marcelo:  {control:6, pressure:5, mobility:7, scramble:9, leglock:4,  berimbolo:2, lapel:3, fundamental:8, wrestling:5, backtake:9, fronthead:7, guardret:7, finish:9},
    };

    /* ================= ë¬¸í•­ ================= */
    const L = (ko,en,ja)=>({ko,en,ja});
    const Q = []; let qid = 0;
    function add(axis, text, opts) { Q.push({ id: ++qid, axis, text, options: opts }); }

    add("control", L("ìƒìœ„ í¬ì§€ì…˜(ì‚¬ì´ë“œ/ë§ˆìš´íŠ¸) ê³ ì • ëŠ¥ë ¥ì€?", "Top position (side/mount) control?", "ãƒˆãƒƒãƒ—ãƒã‚¸ã‚·ãƒ§ãƒ³ï¼ˆã‚µã‚¤ãƒ‰/ãƒã‚¦ãƒ³ãƒˆï¼‰ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«åŠ›ã¯ï¼Ÿ"),
      [{label:L("ë§¤ìš° ê°•í•¨","Very strong","éå¸¸ã«å¼·ã„"), val:10},{label:L("ë³´í†µ","Moderate","æ™®é€š"), val:5},{label:L("ì•½í•¨","Low","å¼±ã„"), val:0}]);
    add("control", L("ë°± ì»¨íŠ¸ë¡¤ì—ì„œ í›…/ì‹œíŠ¸ë²¨íŠ¸ ìœ ì§€ë ¥ì€?", "Back control retention?", "ãƒãƒƒã‚¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ã®ãƒ•ãƒƒã‚¯/ã‚·ãƒ¼ãƒˆãƒ™ãƒ«ãƒˆã®ç¶­æŒåŠ›ã¯ï¼Ÿ"),
      [{label:L("ë§¤ìš° ê°•í•¨","Very strong","éå¸¸ã«å¼·ã„"), val:10},{label:L("ë³´í†µ","Moderate","æ™®é€š"), val:5},{label:L("ì•½í•¨","Low","å¼±ã„"), val:0}]);

    add("pressure", L("ë°”ë””ë½/í”„ë ˆì…” íŒ¨ì‹± ë¹„ì¤‘ì€?", "Bodylock/pressure passing?", "ãƒœãƒ‡ã‚£ãƒ­ãƒƒã‚¯/ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ãƒ‘ã‚¹ã®å‰²åˆã¯ï¼Ÿ"),
      [{label:L("ì£¼ ë¬´ê¸°","Primary","å¾—æ„æŠ€"), val:10},{label:L("ìƒí™©ë³„","Situational","çŠ¶æ³ã«å¿œã˜ã¦"), val:5},{label:L("ë“œë­„","Rare","ã‚ã£ãŸã«ãªã„"), val:0}]);
    add("mobility", L("í† ë ˆì•ˆë„/ë¡±ìŠ¤í…/ë ˆê·¸ë“œë™ ë“± ëª¨ë¹Œë¦¬í‹° íŒ¨ì‹± ë¹„ì¤‘ì€?", "Torreando/long-step/leg-drag mobility?", "ãƒˆãƒªã‚¢ãƒ³ãƒ‰/ãƒ­ãƒ³ã‚°ã‚¹ãƒ†ãƒƒãƒ—/ãƒ¬ãƒƒã‚°ãƒ‰ãƒ©ãƒƒã‚°ãªã©ã€ãƒ¢ãƒ“ãƒªãƒ†ã‚£ãƒ‘ã‚¹ã®å‰²åˆã¯ï¼Ÿ"),
      [{label:L("ì£¼ ë¬´ê¸°","Primary","å¾—æ„æŠ€"), val:10},{label:L("ìƒí™©ë³„","Situational","çŠ¶æ³ã«å¿œã˜ã¦"), val:5},{label:L("ë“œë­„","Rare","ã‚ã£ãŸã«ãªã„"), val:0}]);

    add("scramble", L("í•˜ì´ í…œí¬ ìŠ¤í¬ë¨ë¸” ì„ í˜¸?", "High-tempo scrambles preference?", "ãƒã‚¤ã‚¹ã‚¯ãƒ©ãƒ–ãƒ«ã®å¥½ã¿ã¯ï¼Ÿ"),
      [{label:L("ë§¤ìš° ë†’ìŒ","Very high","éå¸¸ã«é«˜ã„"), val:10},{label:L("ë³´í†µ","Balanced","æ™®é€š"), val:5},{label:L("ë‚®ìŒ","Low","ä½ã„"), val:0}]);

    add("leglock", L("ì—”íŠ¸ë¦¬ ë‹¤ì–‘ì„±(Outside/Inside/K-Guard ë“±)ì€?", "Leg entry diversity (outside/inside/K-guard)?", "ãƒ¬ãƒƒã‚°ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã®å¤šæ§˜æ€§ï¼ˆã‚¢ã‚¦ãƒˆã‚µã‚¤ãƒ‰/ã‚¤ãƒ³ã‚µã‚¤ãƒ‰/Kã‚¬ãƒ¼ãƒ‰ãªã©ï¼‰ã¯ï¼Ÿ"),
      [{label:L("ë‹¤ì–‘/ì‹œìŠ¤í…œì ","Diverse/Systematic","å¤šæ§˜/ä½“ç³»çš„"), val:10},{label:L("ê¸°íšŒí˜•","Opportunistic","æ©Ÿä¼šä¸»ç¾©çš„"), val:5},{label:L("ê±°ì˜ ì—†ìŒ","Rare","ã»ã¨ã‚“ã©ãªã„"), val:0}]);
    add("leglock", L("ë ˆê·¸ë½ì„ ë¨¼ì € ë…¸ë¦¬ë‚˜ìš”(ë ˆê·¸â†’ìƒì²´ ì „í™˜ í¬í•¨)?", "Initiate with legs (legsâ†’upper transitions)?", "ã¾ãšãƒ¬ãƒƒã‚°ãƒ­ãƒƒã‚¯ã‚’ç‹™ã„ã¾ã™ã‹ï¼Ÿï¼ˆãƒ¬ãƒƒã‚°ã‹ã‚‰ä¸ŠåŠèº«ã¸ã®ç§»è¡Œã‚‚å«ã‚€ï¼‰"),
      [{label:L("ìì£¼","Often","ã‚ˆãã‚ã‚‹"), val:10},{label:L("ìƒí™©ë³„","Sometimes","çŠ¶æ³ã«å¿œã˜ã¦"), val:5},{label:L("ê±°ì˜ ì—†ìŒ","Rare","ã»ã¨ã‚“ã©ãªã„"), val:0}]);

    add("berimbolo", L("ë² ë¦¼ë³´ë¡œ/ë³€í˜• ì‚¬ìš© ë¹ˆë„ëŠ”?", "Berimbolo/variations frequency?", "ãƒ™ãƒªãƒ³ãƒœãƒ­/ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½¿ç”¨é »åº¦ã¯ï¼Ÿ"),
      [{label:L("ìì£¼","Often","ã‚ˆãã‚ã‚‹"), val:10},{label:L("ê°€ë”","Sometimes","æ™‚ã€…"), val:5},{label:L("ê±°ì˜ ì—†ìŒ","Rare","ã»ã¨ã‚“ã©ãªã„"), val:0}]);

    add("lapel", L("ë¼í /ì›œ/ë¼ì†Œ ê³„ì—´ ì‚¬ìš© ë¹ˆë„ëŠ”?(Gi)", "Lapel/Worm/Lasso usage (Gi)?", "ãƒ©ãƒšãƒ«/ãƒ¯ãƒ¼ãƒ /ãƒ©ãƒƒã‚½ç³»ã®ä½¿ç”¨é »åº¦ã¯ï¼Ÿï¼ˆGiï¼‰"),
      [{label:L("ìì£¼","Often","ã‚ˆãã‚ã‚‹"), val:10},{label:L("ê°€ë”","Sometimes","æ™‚ã€…"), val:5},{label:L("ê±°ì˜ ì—†ìŒ","Rare","ã»ã¨ã‚“ã©ãªã„"), val:0}]);

    add("fundamental", L("ì •ì„ ì½¤ë³´(ì•”ë°”/ì‚¼ê°/ì´ˆí¬) ì„ í˜¸ë„ëŠ”?", "Classic subs (armbar/triangle/choke)?", "å®šç•ªã®ã‚µãƒ–ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼ˆã‚¢ãƒ¼ãƒ ãƒãƒ¼/ä¸‰è§’çµã‚/ãƒãƒ§ãƒ¼ã‚¯ï¼‰ã®å¥½ã¿ã¯ï¼Ÿ"),
      [{label:L("ë§¤ìš° ë†’ìŒ","Very high","éå¸¸ã«é«˜ã„"), val:10},{label:L("ë³´í†µ","Balanced","æ™®é€š"), val:5},{label:L("ë‚®ìŒ","Low","ä½ã„"), val:0}]);

    add("wrestling", L("í…Œì´í¬ë‹¤ìš´ ì§€í–¥(ë…¸ê¸° ê¸°ì¤€ í¬í•¨)ì€?", "Takedown emphasis (incl. No-Gi)?", "ãƒ†ã‚¤ã‚¯ãƒ€ã‚¦ãƒ³å¿—å‘ï¼ˆNo-Giã‚‚å«ã‚€ï¼‰ã¯ï¼Ÿ"),
      [{label:L("ìš°ì„ ","First","å„ªå…ˆ"), val:10},{label:L("ìƒí™©ë³„","Situational","çŠ¶æ³ã«å¿œã˜ã¦"), val:5},{label:L("ê±°ì˜ ì—†ìŒ","Rare","ã»ã¨ã‚“ã©ãªã„"), val:0}]);

    add("backtake", L("ê°€ë“œ/íŒ¨ìŠ¤ ì¤‘ ë°± í…Œì´í¬ ì „í™˜ ë¹ˆë„ëŠ”?", "Back-take transitions from guard/passing?", "ã‚¬ãƒ¼ãƒ‰/ãƒ‘ã‚¹ä¸­ã®ãƒãƒƒã‚¯ãƒ†ã‚¤ã‚¯ã¸ã®ç§»è¡Œé »åº¦ã¯ï¼Ÿ"),
      [{label:L("ìì£¼","Often","ã‚ˆãã‚ã‚‹"), val:10},{label:L("ê°€ë”","Sometimes","æ™‚ã€…"), val:5},{label:L("ë“œë­„","Rare","ã‚ã£ãŸã«ãªã„"), val:0}]);

    add("fronthead", L("í”„ë¡ íŠ¸ í—¤ë“œë¡ ì²´ì¸(ê¸¸ë¡œí‹´/ë‹¤ìŠ¤) í™œìš©ë„ëŠ”?", "Front-headlock chain (Guillotine/D'Arce)?", "ãƒ•ãƒ­ãƒ³ãƒˆãƒ˜ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ï¼ˆã‚®ãƒ­ãƒãƒ³/ãƒ€ãƒ¼ã‚¹ï¼‰ã®æ´»ç”¨åº¦ã¯ï¼Ÿ"),
      [{label:L("ë†’ìŒ","High","é«˜ã„"), val:10},{label:L("ë³´í†µ","Moderate","æ™®é€š"), val:5},{label:L("ë‚®ìŒ","Low","ä½ã„"), val:0}]);

    add("guardret", L("ì˜¤í”ˆê°€ë“œ ë¦¬í…ì…˜(ë¦¬í”„ë ˆì´ë°/ê·¸ë€ë¹„)ì˜ ìì‹ ê°ì€?", "Open-guard retention (reframing/granby)?", "ã‚ªãƒ¼ãƒ—ãƒ³ã‚¬ãƒ¼ãƒ‰ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³ï¼ˆãƒªãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°/ã‚°ãƒ©ãƒ³ãƒ“ãƒ¼ï¼‰ã¸ã®è‡ªä¿¡ã¯ï¼Ÿ"),
      [{label:L("ë†’ìŒ","High","é«˜ã„"), val:10},{label:L("ë³´í†µ","Moderate","æ™®é€š"), val:5},{label:L("ë‚®ìŒ","Low","ä½ã„"), val:0}]);

    add("finish", L("ê²½ê¸° ìš´ì˜ ì„±í–¥ì€?", "Match orientation?", "è©¦åˆã®é‹å–¶å‚¾å‘ã¯ï¼Ÿ"),
      [
        { label: L("ê³µê²©ì  ì„œë¸Œë¯¸ì…˜ ì¶”êµ¬", "Aggressive submission hunting", "ç©æ¥µçš„ãªã‚µãƒ–ãƒŸãƒƒã‚·ãƒ§ãƒ³ç‹™ã„"), val: 10 },
        { label: L("í¬ì§€ì…˜Â·í¬ì¸íŠ¸ ìš°ì„ ", "Position/points first", "ãƒã‚¸ã‚·ãƒ§ãƒ³/ãƒã‚¤ãƒ³ãƒˆå„ªå…ˆ"), val: 0 },
        { label: L("ìƒí™©ì— ë”°ë¼ ì¡°ì ˆ", "Situational balance", "çŠ¶æ³ã«å¿œã˜ã¦èª¿æ•´"), val: 5 }
      ]
    );

    const QUESTIONS = Q;

    /* ================= ìŠ¤ì½”ì–´ë§ ================= */
    function weightedCosine(a, b) {
      let dot=0, na=0, nb=0;
      for (const k of Object.keys(WEIGHTS)) {
        const w=WEIGHTS[k]||1, x=(a[k]||0)*w, y=(b[k]||0)*w;
        dot += x*y; na += x*x; nb += y*y;
      }
      return dot / (Math.sqrt(na||1)*Math.sqrt(nb||1));
    }

    /* ================= ê²°ê³¼ ì½”ë©˜íŠ¸ ================= */
    function buildAdvice(ax) {
      const t=[];
      if ((ax.finish||0)>=8) t.push("í”¼ë‹ˆì‹œ ì‹œí€€ìŠ¤ë¥¼ í‘œì¤€í™”í•˜ì„¸ìš”: ì—”íŠ¸ë¦¬â†’ê³ ì •â†’í”¼ë‹ˆì‹œ ì „í™˜ì„ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ.");
      if ((ax.leglock||0)>=8) t.push("ë ˆê·¸ë½ ì²´ì¸ì„ ë” ê¹Šê²Œ: ë‹¤ì–‘í•œ ì—”íŠ¸ë¦¬ì™€ ë°˜ì—”íŠ¸ë¦¬ ëŒ€ì‘ì„ ë£¨í‹´í™”.");
      if ((ax.berimbolo||0)>=8) t.push("ë² ë¦¼ë³´ë¡œ ê°ë„Â·ê·¸ë¦½ ë””í…Œì¼ì„ ë‹¤ë“¬ê³  ë°± ê³ ì •ì„ ë°˜ë³µ.");
      if ((ax.lapel||0)>=8) t.push("ë¼í  ì—”íŠ¸ë¦¬ í›„ ìŠ¤ìœ•â†’ë°± ì—°ê²° ë£¨í‹´ì„ ìƒí™©ë³„ë¡œ ì •í˜•í™”.");
      if ((ax.pressure||0)>=8) t.push("í”„ë ˆì…” íŒ¨ìŠ¤ì—ì„œ ì‚¬ì´ë“œâ†’ë§ˆìš´íŠ¸ ì—°ê²° ë””í…Œì¼ ê³ ì •.");
      if ((ax.mobility||0)>=8) t.push("ëª¨ë¹Œë¦¬í‹° íŒ¨ìŠ¤ ë’¤ ë°±Â·ë§ˆìš´íŠ¸ ì „í™˜ ê°ë„ ëª…í™•í™”.");
      if ((ax.wrestling||0)>=8) t.push("ë ˆìŠ¬ ì—”íŠ¸ë¦¬ ì‹¤íŒ¨ ì‹œ ë¦¬ì»¤ë²„ë¦¬/ë¦¬í…ì…˜ í”Œë¡œìš° ì¤€ë¹„.");
      if ((ax.backtake||0)>=8) t.push("íƒ‘/ê°€ë“œ ëª¨ë‘ì—ì„œ ë°± ì „í™˜ íƒ€ì´ë°ì„ ì²´í¬ë¦¬ìŠ¤íŠ¸í™”.");
      if ((ax.fronthead||0)>=8) t.push("í”„ë¡ íŠ¸ í—¤ë“œë¡ì—ì„œ ë‹¤ìŠ¤/ì•„ë‚˜ì½˜ë‹¤ ë³€ì£¼ í™•ì¥.");
      if ((ax.guardret||0)>=8) t.push("ë¦¬í…ì…˜â†’ë¦¬ë¹Œë“œâ†’ì¹´ìš´í„° ì—”íŠ¸ë¦¬ íë¦„ì„ ì‹œìŠ¤í…œí™”.");
      if (!t.length) t.push("í˜„ì¬ëŠ” ê· í˜•í˜•ì…ë‹ˆë‹¤. ë£°Â·ìƒëŒ€ ìŠ¤íƒ€ì¼ì— ë§ì¶° ê°•ì  1~2ì¶•ì„ ë˜ë ·í•˜ê²Œ ë°€ì–´ë³´ì„¸ìš”.");
      return t;
    }

    /* ================= ê³µìœ  í—¬í¼ ================= */
    function buildShareURL(platform, text, url) {
      const t = encodeURIComponent(text), u = encodeURIComponent(url);
      if (platform === "line")      return `https://line.me/R/msg/text/?${t}%20${u}`;
      if (platform === "whatsapp")  return `https://api.whatsapp.com/send?text=${t}%20${u}`;
      if (platform === "facebook")  return `https://www.facebook.com/sharer/sharer.php?u=${u}`;
      if (platform === "telegram")  return `https://t.me/share/url?url=${u}&text=${t}`;
      if (platform === "x")         return `https://twitter.com/intent/tweet?text=${t}&url=${u}`;
      if (platform === "sms")       return `sms:?&body=${t}%20${u}`;
      return url;
    }
    function openShare(url) {
      const w = window.open(url, "_blank", "noopener,noreferrer,width=600,height=700");
      if (!w) location.href = url;
    }

    /* ================= App ================= */
    function App() {
      const [lang, setLang] = useState(detectLang());
      const t = STR[lang] || STR.en;

      const [step, setStep] = useState("intro");
      const [qIdx, setQIdx] = useState(0);
      const [answers, setAnswers] = useState([]);
      const [shared, setShared] = useState(null);

      useEffect(()=>{
        const r = new URLSearchParams(location.search).get("r");
        if (r) { try { const j = JSON.parse(atob(r)); if (j?.axes) { setShared(j); setStep("result"); } } catch(e){} }
      },[]);

      const axes = useMemo(()=>{
        const sum = Object.fromEntries(AXES.map(ax=>[ax.key,0]));
        const cnt = Object.fromEntries(AXES.map(ax=>[ax.key,0]));
        if (shared?.axes) return shared.axes;
        for (const a of answers) {
          const q = QUESTIONS.find(x=>x.id===a.id);
          if (q) { sum[q.axis]+=a.val; cnt[q.axis]+=1; }
        }
        const acc = {};
        for (const k of Object.keys(sum)) acc[k] = cnt[k] ? (sum[k]/cnt[k]) : 0;
        return acc;
      }, [answers, shared]);

      const winnerObj = useMemo(()=>{
        let best=null, score=-1;
        for (const at of ATHLETES) {
          const prof = PROFILES[at.id];
          if (!prof) continue;
          const sim = weightedCosine(axes, prof);
          if (sim > score || best==null) { score=sim; best=at; }
        }
        return { at: best, sim: score };
      }, [JSON.stringify(axes)]);

      function pick(val) {
        const q = QUESTIONS[qIdx];
        if (!q) return;
        const next = answers.filter(a=>a.id!==q.id).concat({id:q.id, val});
        setAnswers(next);
      }

      return (
        <div className="max-w-5xl mx-auto px-4 py-10">
          <header className="text-center mb-8">
            <h1 className="text-3xl md:text-5xl font-extrabold tracking-tight">{t.title}</h1>
            <p className="text-gray-600 mt-2">{t.subtitle}</p>
          </header>

          <main className="rounded-3xl shadow-xl bg-white p-6 md:p-10 glass">
            {step==="intro" && (
              <div className="text-center">
                <div className="mt-3 inline-flex items-center gap-2 text-sm text-gray-500">
                  <span>Language</span>
                  <select className="border rounded-xl px-3 py-2" value={lang} onChange={(e)=>setLang(e.target.value)}>
                    {Object.keys(STR).map(k=>(<option key={k} value={k}>{k}</option>))}
                  </select>
                </div>
                <button className="mt-6 md:mt-8 px-6 py-3 rounded-2xl bg-black text-white hover:opacity-90 transition"
                        onClick={()=>setStep("quiz")}>{t.start}</button>
              </div>
            )}

            {step==="quiz" && (
              <Quiz
                lang={lang} t={t}
                qIdx={qIdx} setQIdx={setQIdx}
                answers={answers} pick={pick}
                onSubmit={()=>setStep("result")}
              />
            )}

            {step==="result" && (
              <ErrorBoundary fallback={<div className="mt-3"><button className="mt-2 px-4 py-2 rounded-xl border" onClick={()=>{setStep("intro");setQIdx(0);setAnswers([]);setShared(null);}}>ë‹¤ì‹œ í•˜ê¸°</button></div>}>
                <Result
                  lang={lang} t={t}
                  axes={axes} winner={winnerObj.at} sim={winnerObj.sim}
                  onRestart={()=>{ setStep("intro"); setQIdx(0); setAnswers([]); setShared(null); }}
                />
              </ErrorBoundary>
            )}

            <p className="text-xs text-gray-400 mt-6">Â© MK Corporation</p>
          </main>
        </div>
      );
    }

    /* ================= ì•ˆì •í™”ëœ Quiz ================= */
    function Quiz({ t, lang, qIdx, setQIdx, answers, pick, onSubmit }) {
      const total = QUESTIONS.length;
      const q = QUESTIONS[qIdx];
      if (!q) return null;

      const picked = answers.find(a => a.id === q.id)?.val;
      const pct = Math.round(((qIdx + 1) / total) * 100);
      const isLast = qIdx === total - 1;

      function submitNow() {
        try {
          const hasAnyAnswer = answers.length > 0;
          if (picked == null && !hasAnyAnswer) return;
          onSubmit();
          requestAnimationFrame(() => window.scrollTo({ top: 0, behavior: "smooth" }));
        } catch (e) { onSubmit(); }
      }
      function next() { setQIdx(i => Math.min(total - 1, i + 1)); }
      function prev() { setQIdx(i => Math.max(0, i - 1)); }
      function onPress(handler) { return (ev) => { ev.preventDefault(); handler(); }; }

      useEffect(() => {
        function onKey(e) {
          if (e.key === "Enter") {
            if (!isLast && picked != null) next();
            else if (isLast && picked != null) submitNow();
          }
        }
        window.addEventListener("keydown", onKey);
        return () => window.removeEventListener("keydown", onKey);
      }, [isLast, picked]);

      return (
        <div>
          <div className="w-full">
            <div className="flex justify-between text-sm text-gray-500 mb-1">
              <span>Q{qIdx + 1}</span>
              <span>{pct}%</span>
            </div>
            <div className="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
              <div className="h-full bg-black/80" style={{ width: pct + "%" }} />
            </div>
          </div>

          <h2 className="text-xl md:text-2xl font-bold mt-6">{q.text[lang] || q.text.en}</h2>

          <div className="grid gap-3 mt-4">
            {q.options.map((opt, i) => (
              <button
                key={i}
                type="button"
                onClick={() => pick(opt.val)}
                onTouchEnd={() => pick(opt.val)}
                className={
                  "text-left border rounded-2xl p-4 transition " +
                  (picked === opt.val
                    ? "border-black bg-black text-white"
                    : "border-gray-200 hover:border-black")
                }
              >
                {opt.label[lang] || opt.label.en}
              </button>
            ))}
          </div>

          <div className="flex justify-between mt-6">
            <button
              type="button"
              className="px-4 py-2 rounded-xl border border-gray-300"
              onClick={onPress(prev)}
              onTouchEnd={onPress(prev)}
              disabled={qIdx === 0}
            >
              {t.prev}
            </button>

            {!isLast ? (
              <button
                type="button"
                className="px-4 py-2 rounded-xl bg-black text-white disabled:opacity-40"
                onClick={onPress(next)}
                onTouchEnd={onPress(next)}
                disabled={picked == null}
              >
                {t.next}
              </button>
            ) : (
              <button
                type="button"
                className="px-4 py-2 rounded-xl bg-black text-white disabled:opacity-40"
                onClick={onPress(submitNow)}
                onTouchEnd={onPress(submitNow)}
                disabled={picked == null && answers.length === 0}
              >
                {t.submit}
              </button>
            )}
          </div>
        </div>
      );
    }

    /* ================= ê²°ê³¼ ================= */
    function Result({ t, lang, axes, winner, sim, onRestart }) {
      const pickedAth = winner || ATHLETES[0];
      const safeAth = pickedAth || { id:"unknown", name:"Unknown", img:[PH("Unknown")], traits:[], compliment:"" };

      const payload = { axes, winner: safeAth.id, ts: Date.now() };
      const url = location.origin + location.pathname + "?lang=" + lang + "&r=" + btoa(JSON.stringify(payload));
      const text = (STR[lang]?.title || STR.en.title) + " â€” " + (safeAth.name || "");

      const SHARE = {
        line:      buildShareURL("line", text, url),
        whatsapp:  buildShareURL("whatsapp", text, url),
        facebook:  buildShareURL("facebook", text, url),
        telegram:  buildShareURL("telegram", text, url),
        x:         buildShareURL("x", text, url),
        sms:       buildShareURL("sms", text, url),
      };

      function shareKakao() {
        const key = "6293a9061e25a8cfabaecddf8b4b4d1e"; // ë³¸ì¸ í‚¤ë¡œ êµì²´ + ë„ë©”ì¸ ë“±ë¡ í•„ìš”
        try {
          if (window.Kakao && !window.Kakao.isInitialized()) window.Kakao.init(key);
          if (window.Kakao?.Share && key !== "YOUR_KAKAO_JAVASCRIPT_KEY") {
            window.Kakao.Share.sendDefault({
              objectType:'feed',
              content:{ title: STR[lang]?.title || STR.en.title, description: safeAth?.name || "",
                        imageUrl:"https://upload.wikimedia.org/wikipedia/commons/0/0e/Gordon_Ryan_2019.jpg",
                        link:{ mobileWebUrl:url, webUrl:url } },
              buttons:[{ title:'ì—´ì–´ë³´ê¸°', link:{ mobileWebUrl:url, webUrl:url } }]
            });
            return;
          }
        } catch(e){}
        navigator.clipboard?.writeText(url);
        alert(STR[lang]?.copied || STR.en.copied);
      }

      function shareNative() {
        if (navigator.share) {
          navigator.share({ title: document.title, text: text, url }).catch(()=>{});
        } else {
          navigator.clipboard?.writeText(url);
          alert(STR[lang]?.copied || STR.en.copied);
        }
      }
      function copyLink() {
        navigator.clipboard?.writeText(url);
        alert(STR[lang]?.copied || STR.en.copied);
      }

      return (
        <div>
          <h2 className="text-xl md:text-2xl font-extrabold">{t.yourResult}</h2>

          <div className="grid md:grid-cols-2 gap-6 items-center mt-4">
            <SmartImage srcs={safeAth.img} alt={safeAth.name} className="w-full rounded-2xl shadow-md object-cover" />
            <div>
              <h3 className="text-2xl font-bold">{safeAth.name}</h3>
              <ul className="mt-2 list-disc list-inside text-gray-700">
                {(safeAth.traits || []).map((tr,i)=>(<li key={i}>{tr}</li>))}
              </ul>
              {safeAth.compliment && <p className="mt-3 font-medium">{safeAth.compliment}</p>}
              <p className="mt-3 text-sm text-gray-500">ë§¤ì¹­ë„: { Number(sim*100).toFixed(1) }%</p>

              <div className="mt-4">
                <RadarChart axes={axes} ath={safeAth} lang={lang} />
              </div>

              <div className="mt-4">
                <h4 className="font-bold text-gray-800">ìŠ¤íƒ€ì¼ ë¶„ì„ ì½”ë©˜íŠ¸</h4>
                <ul className="mt-2 text-sm text-gray-700 list-disc list-inside">
                  {buildAdvice(axes).map((advice, i)=><li key={i}>{advice}</li>)}
                </ul>
              </div>

              <div className="mt-4">
                <div className="text-sm text-gray-600 mb-2">{t.shareVia}</div>
                <div className="flex flex-wrap gap-2">
                  <a className="px-3 py-2 rounded-xl bg-[#FEE500] text-black" href="#" onClick={(e)=>{e.preventDefault(); shareKakao();}}>Kakao</a>
                  <a className="px-3 py-2 rounded-xl border" href="#" onClick={(e)=>{e.preventDefault(); openShare(SHARE.line);}}>LINE</a>
                  <a className="px-3 py-2 rounded-xl border" href="#" onClick={(e)=>{e.preventDefault(); openShare(SHARE.whatsapp);}}>WhatsApp</a>
                  <a className="px-3 py-2 rounded-xl border" href="#" onClick={(e)=>{e.preventDefault(); openShare(SHARE.facebook);}}>Facebook</a>
                  <a className="px-3 py-2 rounded-xl border" href="#" onClick={(e)=>{e.preventDefault(); openShare(SHARE.telegram);}}>Telegram</a>
                  <a className="px-3 py-2 rounded-xl border" href="#" onClick={(e)=>{e.preventDefault(); openShare(SHARE.x);}}>X</a>
                  <a className="px-3 py-2 rounded-xl border" href={SHARE.sms}>SMS</a>
                  <a className="px-3 py-2 rounded-xl bg-black text-white" href="#" onClick={(e)=>{e.preventDefault(); shareNative();}}>Share</a>
                  <a className="px-3 py-2 rounded-xl border" href="#" onClick={(e)=>{e.preventDefault(); copyLink();}}>{t.share}</a>
                </div>
              </div>
              <div className="flex gap-2 mt-4">
                <button className="px-4 py-2 rounded-xl border" onClick={onRestart}>{t.restart}</button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    /* ============ RadarChart (ì´ë¦„ ì¶©ëŒ ë°©ì§€) ============ */
    function RadarChart({ axes, ath, lang }) {
      const canvasRef = useRef(null);
      const chartRef = useRef(null);

      useEffect(() => {
        const ChartJS = window.Chart; // ì „ì—­ Chart.js ì•ˆì „ ì°¸ì¡°
        if (!ChartJS || !canvasRef.current) return;

        const ctx = canvasRef.current.getContext('2d');
        const labels = AXES.map(ax => ax.label[lang] || ax.label.en);
        const scores = AXES.map(ax => (axes[ax.key] || 0) * 10); // 0-100ìœ¼ë¡œ ìŠ¤ì¼€ì¼
        const athScores = AXES.map(ax => (PROFILES[ath.id][ax.key] || 0) * 10);

        const data = {
          labels,
          datasets: [
            {
              label: 'ë‚˜ì˜ ìŠ¤íƒ€ì¼',
              data: scores,
              backgroundColor: 'rgba(54, 162, 235, 0.4)',
              borderColor: 'rgb(54, 162, 235)',
              pointBackgroundColor: 'rgb(54, 162, 235)',
              pointBorderColor: '#fff',
              pointHoverBackgroundColor: '#fff',
              pointHoverBorderColor: 'rgb(54, 162, 235)'
            },
            {
              label: `${ath.name} ìŠ¤íƒ€ì¼`,
              data: athScores,
              backgroundColor: 'rgba(255, 99, 132, 0.4)',
              borderColor: 'rgb(255, 99, 132)',
              pointBackgroundColor: 'rgb(255, 99, 132)',
              pointBorderColor: '#fff',
              pointHoverBackgroundColor: '#fff',
              pointHoverBorderColor: 'rgb(255, 99, 132)'
            }
          ]
        };

        const config = {
          type: 'radar',
          data,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            elements: { line: { borderWidth: 3 } },
            scales: {
              r: {
                min: 0, max: 100,
                ticks: { display: false, stepSize: 25 },
                pointLabels: { font: { size: 12 }, color: 'rgb(51, 51, 51)' }
              }
            },
            plugins: { legend: { display: true, position: 'top' } }
          },
        };

        if (chartRef.current) chartRef.current.destroy();
        chartRef.current = new ChartJS(ctx, config);

        return () => { if (chartRef.current) chartRef.current.destroy(); };
      }, [axes, ath.id, lang]);

      return (
        <div style={{ height: '300px', width: '100%' }}>
          <canvas ref={canvasRef} />
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
